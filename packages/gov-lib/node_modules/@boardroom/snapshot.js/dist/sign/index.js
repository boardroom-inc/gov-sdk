!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cross-fetch"),require("@ethersproject/address")):"function"==typeof define&&define.amd?define(["exports","cross-fetch","@ethersproject/address"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).snapshot={},e.fetch,e.address)}(this,(function(e,t,n){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=s(t);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(e,t,n,s){return new(n||(n=Promise))((function(r,a){function i(e){try{p(s.next(e))}catch(e){a(e)}}function o(e){try{p(s.throw(e))}catch(e){a(e)}}function p(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}p((s=s.apply(e,t||[])).next())}))}function i(e,t){var n,s,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&a[0]?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var o={Space:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"settings",type:"string"}]},p={Proposal:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"type",type:"string"},{name:"title",type:"string"},{name:"body",type:"string"},{name:"discussion",type:"string"},{name:"choices",type:"string[]"},{name:"start",type:"uint64"},{name:"end",type:"uint64"},{name:"snapshot",type:"uint64"},{name:"plugins",type:"string"},{name:"app",type:"string"}]},u={CancelProposal:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"string"}]},c={CancelProposal:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"bytes32"}]},m={Vote:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"string"},{name:"choice",type:"uint32"},{name:"reason",type:"string"},{name:"app",type:"string"},{name:"metadata",type:"string"}]},y={Vote:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"string"},{name:"choice",type:"uint32[]"},{name:"reason",type:"string"},{name:"app",type:"string"},{name:"metadata",type:"string"}]},d={Vote:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"string"},{name:"choice",type:"string"},{name:"reason",type:"string"},{name:"app",type:"string"},{name:"metadata",type:"string"}]},l={Vote:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"bytes32"},{name:"choice",type:"uint32"},{name:"reason",type:"string"},{name:"app",type:"string"},{name:"metadata",type:"string"}]},f={Vote:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"bytes32"},{name:"choice",type:"uint32[]"},{name:"reason",type:"string"},{name:"app",type:"string"},{name:"metadata",type:"string"}]},h={Vote:[{name:"from",type:"address"},{name:"space",type:"string"},{name:"timestamp",type:"uint64"},{name:"proposal",type:"bytes32"},{name:"choice",type:"string"},{name:"reason",type:"string"},{name:"app",type:"string"},{name:"metadata",type:"string"}]},g={Follow:[{name:"from",type:"address"},{name:"space",type:"string"}]},b={Unfollow:[{name:"from",type:"address"},{name:"space",type:"string"}]},v={Subscribe:[{name:"from",type:"address"},{name:"space",type:"string"}]},w={Unsubscribe:[{name:"from",type:"address"},{name:"space",type:"string"}]},q={Profile:[{name:"from",type:"address"},{name:"timestamp",type:"uint64"},{name:"profile",type:"string"}]},x={Statement:[{name:"from",type:"address"},{name:"timestamp",type:"uint64"},{name:"space",type:"string"},{name:"about",type:"string"},{name:"statement",type:"string"}]},S={Alias:[{name:"from",type:"address"},{name:"alias",type:"address"}]},j={DeleteSpace:[{name:"from",type:"address"},{name:"space",type:"string"}]},P={hub:"https://hub.snapshot.org",sequencer:"https://seq.snapshot.org"},k={hub:"https://testnet.snapshot.org",sequencer:"https://testnet.seq.snapshot.org"},T={hub:"http://localhost:3000",sequencer:"http://localhost:3001"},V={name:"snapshot",version:"0.1.4"},A=function(){function e(e,t){void 0===e&&(e=P.sequencer),void 0===t&&(t={}),e=(e=(e=e.replace(P.hub,P.sequencer)).replace(k.hub,k.sequencer)).replace(T.hub,T.sequencer),this.address=e,this.options=t}return e.prototype.sign=function(e,t,s,r){return a(this,void 0,void 0,(function(){var a,o,p,u;return i(this,(function(i){switch(i.label){case 0:return a=(null==e?void 0:e.getSigner)?e.getSigner():e,o=n.getAddress(t),s.from=s.from?n.getAddress(s.from):o,s.timestamp||(s.timestamp=parseInt((Date.now()/1e3).toFixed())),p={domain:V,types:r,message:s},[4,a._signTypedData(V,p.types,s)];case 1:return u=i.sent(),[4,this.send({address:o,sig:u,data:p})];case 2:return[2,i.sent()]}}))}))},e.prototype.send=function(e){return a(this,void 0,void 0,(function(){var t,n;return i(this,(function(s){return t=this.address,"0x"===e.sig&&this.options.relayerURL&&(t=this.options.relayerURL),n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)},[2,new Promise((function(e,s){r.default(t,n).then((function(t){if(t.ok)return e(t.json());throw t})).catch((function(e){return e.json().then((function(e){return s(e)}))}))}))]}))}))},e.prototype.space=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,o)];case 1:return[2,s.sent()]}}))}))},e.prototype.proposal=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return n.discussion||(n.discussion=""),n.app||(n.app=""),[4,this.sign(e,t,n,p)];case 1:return[2,s.sent()]}}))}))},e.prototype.cancelProposal=function(e,t,n){return a(this,void 0,void 0,(function(){var s;return i(this,(function(r){switch(r.label){case 0:return s=n.proposal.startsWith("0x"),[4,this.sign(e,t,n,s?c:u)];case 1:return[2,r.sent()]}}))}))},e.prototype.vote=function(e,t,n){return a(this,void 0,void 0,(function(){var s,r,a;return i(this,(function(i){switch(i.label){case 0:return s="shutter"===(null==n?void 0:n.privacy),n.reason||(n.reason=""),n.app||(n.app=""),n.metadata||(n.metadata="{}"),r=n.proposal.startsWith("0x"),a=r?l:m,["approval","ranked-choice"].includes(n.type)&&(a=r?f:y),!s&&["quadratic","weighted"].includes(n.type)&&(a=r?h:d,n.choice=JSON.stringify(n.choice)),s&&(a=r?h:d),delete n.privacy,delete n.type,[4,this.sign(e,t,n,a)];case 1:return[2,i.sent()]}}))}))},e.prototype.follow=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,g)];case 1:return[2,s.sent()]}}))}))},e.prototype.unfollow=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,b)];case 1:return[2,s.sent()]}}))}))},e.prototype.subscribe=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,v)];case 1:return[2,s.sent()]}}))}))},e.prototype.unsubscribe=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,w)];case 1:return[2,s.sent()]}}))}))},e.prototype.profile=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,q)];case 1:return[2,s.sent()]}}))}))},e.prototype.statement=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,x)];case 1:return[2,s.sent()]}}))}))},e.prototype.alias=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,S)];case 1:return[2,s.sent()]}}))}))},e.prototype.deleteSpace=function(e,t,n){return a(this,void 0,void 0,(function(){return i(this,(function(s){switch(s.label){case 0:return[4,this.sign(e,t,n,j)];case 1:return[2,s.sent()]}}))}))},e}();e.default=A,e.domain=V,Object.defineProperty(e,"__esModule",{value:!0})}));
